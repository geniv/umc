' Gambas class file

PRIVATE $tasks AS NEW String[]

PUBLIC SUB taskconfirm_Click()
  IF taskinput.Text THEN 
    $tasks.add(taskinput.Text)
    renderTask()
    taskinput.Clear
    taskframe.Visible = FALSE
    tasknew.Enabled = TRUE
  ENDIF 
END

PUBLIC SUB Form_MouseDown()
  IF Mouse.Left THEN 
    taskframe.Visible = FALSE
    tasknew.Enabled = TRUE
  ENDIF 
END

PUBLIC SUB tasknew_Click()
  taskframe.Visible = TRUE
  tasknew.Enabled = FALSE
  taskinput.SetFocus()
END


PUBLIC SUB Form_Open()
  loadTask()
  manager.Text = Settings["settings/manager", ""]
END

PUBLIC SUB Form_Close()
  saveTask()
  'TODO melo by nejak varovat ze zmeny v policku managet se projevi az po opetovnem spusteni aplikace!
  Settings["settings/manager"] = manager.Text
END


PUBLIC SUB tasklist_KeyPress()
  IF tasklist.Index > -1 THEN 
    IF Key.Delete AND Message.Delete(Subst(("Opravdu smazat tuto ulohu: '&1' ?"), $tasks[tasklist.Index]), ("Ano"), ("Ne")) = 1 THEN 
      $tasks.Delete(tasklist.Index)
      renderTask()
    ENDIF 
  ENDIF 
END


PRIVATE SUB renderTask()
  DIM item AS String
  tasklist.Clear
  FOR EACH item IN $tasks
    tasklist.Add(item)
  NEXT
END


PRIVATE SUB saveTask()
  DIM item AS String
  DIM index AS Integer
  'ulozeni task
  Settings["settings/taskcount"] = $tasks.length
  FOR EACH item IN $tasks
    Settings["settings/task" & index] = item
    INC index
  NEXT 
END


PRIVATE SUB loadTask()
  DIM count, i AS Integer
  $tasks.Clear
  count = Settings["settings/taskcount", 0]
  FOR i = 0 TO count - 1
    $tasks.Add(Settings["settings/task" & i, ""])
  NEXT 
  renderTask()
END

